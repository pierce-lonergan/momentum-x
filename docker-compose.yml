# ╔══════════════════════════════════════════════════════════════╗
# ║  docker compose up        → Paper trading (default)         ║
# ║  docker compose up --build → Rebuild + run                  ║
# ║  docker compose run bot backtest → Run backtester            ║
# ╚══════════════════════════════════════════════════════════════╝

services:
  bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: momentum-x
    env_file:
      - .env
    environment:
      - PYTHONPATH=/app
    volumes:
      # Persist logs and session data between runs
      - ./logs:/app/logs
      - ./data:/app/data
    restart: unless-stopped
    # Override command: docker compose run bot evaluate
    command: ["paper"]

  # ── Run tests in container ──
  test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: momentum-x-test
    environment:
      - PYTHONPATH=/app
    command: ["python", "-m", "pytest", "tests/", "-v", "--tb=short"]
    profiles:
      - testing
